name: Free VM with Playit Tunnel

on:
  workflow_dispatch: # Run manually from GitHub Actions tab

jobs:
  run-vm:
    runs-on: ubuntu-latest
    steps:
      - name: Update Packages
        run: sudo apt update -y

      - name: Download Playit Client
        run: |
          wget https://github.com/playit-cloud/playit-agent/releases/latest/download/playit-linux-amd64
          chmod +x playit-linux-amd64
          nohup ./playit-linux-amd64 &

      - name: Show VM Info
        run: |
          echo "==== VM Info ===="
          uname -a
          lscpu
          free -h
          df -h
          echo "==== Tunnel Started ===="
          echo "Login to https://playit.gg/ and check your tunnel."

      - name: Keep VM Alive
        run: |
          echo "Keeping VM alive for 6h"
          sleep 6h
