name: Free VM with Playit Tunnel

on:
  workflow_dispatch:

jobs:
  run-vm:
    runs-on: ubuntu-latest
    steps:
      - name: Show VM Info
        run: |
          echo "==== VM Info ===="
          uname -a
          lscpu
          free -h
          df -h

      - name: Download Playit Agent
        run: |
          wget https://github.com/playit-cloud/playit-agent/releases/latest/download/playit-linux-amd64
          chmod +x playit-linux-amd64

      - name: Get Claim Link (Foreground Mode)
        run: |
          echo "==== Claim Link ===="
          echo "Copy the claim link below and open in your Playit.gg account"
          timeout 30s ./playit-linux-amd64 || true
          echo "===================="
          echo "⚠️ Agar claim link miss ho gaya to 'View raw logs' me check karo"

      - name: Run Playit Agent in Background
        run: |
          nohup ./playit-linux-amd64 > playit.log 2>&1 &
          echo "Playit agent is now running in background"
          sleep 5
          tail -n 20 playit.log || true

      - name: Keep VM Alive
        run: |
          echo "==== VM Running for 6h ===="
          sleep 6h
